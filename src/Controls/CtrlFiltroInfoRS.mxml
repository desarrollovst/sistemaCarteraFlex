<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="250" height="100" creationPolicy="all">
 
<mx:Metadata>
	[Event(name="cargaSucursal", type="cargaSucursal")]
	[Event(name="cargaRegion", type="cargaRegion")]
</mx:Metadata>

<mx:Script>
	<![CDATA[
		import Data.Globales;
		import Data.Utils;
		import mx.collections.ArrayCollection;
		import mx.controls.Alert;
		import mx.core.Application;
		import mx.effects.easing.Elastic;
		import mx.managers.PopUpManager;
		import mx.rpc.events.ResultEvent;
		import mx.rpc.events.FaultEvent;
		import mx.rpc.soap.WebService;
		import mx.utils.ObjectUtil;
		import mx.validators.Validator;	
		
		public var _xmlReg:XML =  new XML();
		public var _xmlSucursal:XMLList = new XMLList;
		
		public var regObj:ArrayCollection = new ArrayCollection();
		public var sucursalObj:ArrayCollection = new ArrayCollection();
		
		public var wsMS:WebService;
		private var iniSelA:String;
		private var du:Utils;
		private var global:Globales;
	
		public function agregaInicial(codigo:String, texto:String):Object{
			var oItem:Object = new Object();
			oItem.codigo = codigo;	
			oItem.nombre = texto;
			return oItem;
		}		
						
		public function cargaRegion():void{
			_xmlReg = Application.application._xmlReg;
			formateaRegion();
			if(_xmlReg.elements().length() == 1){
				cboRegion.selectedIndex = 1;
				cboRegion.enabled = false;
			}
			cargaSucursal();
		}		
		
		public function cargaSucursal():void{
			_xmlSucursal = Application.application._xmlSuc.Table.(CDGRG.toString().toLowerCase() == cboRegion.selectedItem.codigo.toString().toLowerCase());
			
			sucursalObj.removeAll();
			sucursalObj.refresh();	
			sucursalObj.addItem(agregaInicial("000", iniSelA))
			
			cboSucursal.enabled = true;
			formateaSucursal();
			
			if(_xmlSucursal.length() == 1){
				cboSucursal.selectedIndex = 1;
				cboSucursal.enabled = false;
			}
			dispatchEvent(new Event("cargaSucursal"));
		}
				
					
		private function formateaSucursal():void{
			var cont:int = _xmlSucursal.length();
			var oItem:Object;
			var item:Array = new Array();
			
			for(var i:int = 0; i < cont; i++){
				oItem = new Object();
				oItem.codigo = _xmlSucursal.CODIGO[i].toString();
				oItem.nombre = _xmlSucursal.NOMBRE[i].toString();
				item.push(oItem);
			}
			sucursalObj.source = sucursalObj.source.concat(item);
		}			
		
		private function formateaRegion():void{
			var cont:int = _xmlReg.elements().length();
			var oItem:Object;
			var item:Array = new Array();
			
			for(var i:int = 0; i < cont; i++){
				if(_xmlReg.Table[i].CODIGO != '004'){
					oItem = new Object();
					oItem.codigo = _xmlReg.Table[i].CODIGO;
					oItem.nombre = _xmlReg.Table[i].NOMBRE;
					item.push(oItem);
				}
			}
			regObj.source = regObj.source.concat(item);
		}
		
		public function init(band:Boolean = false):void{
			global = new Globales();
			du = new Utils();
			if(band == false)
				iniSelA = "--Todas--";
			else
				iniSelA = "--Seleccionar--";
			limpiar();
		}
		
		private function initConexion():void{				
			wsMS = new WebService();			
			wsMS.wsdl = Application.application.wsStr.wsdlServ.toString();
			wsMS.loadWSDL();
		}	
		
		public function limpiar():void{
			cboRegion.enabled = true;
			cboSucursal.enabled = true;
			regObj.removeAll();
			regObj.refresh();
			regObj.addItem(agregaInicial("000", iniSelA));
			cboRegion.dataProvider = regObj;		
			cboSucursal.dataProvider = sucursalObj;
			cargaRegion();	
		}
		
		private function modificaRegion():void{
			cargaSucursal();
		}

		public function obtieneRegion():String{
			return cboRegion.selectedItem.codigo;
		}
		
		public function obtieneSucursal():String{
			return cboSucursal.selectedItem.codigo;
		}
		
	]]>
</mx:Script>
	<mx:Label x="4" y="3" text="RegiÃ³n"/>
	<mx:ComboBox id="cboRegion" x="4" y="21" labelField="nombre" change="modificaRegion()" width="170"></mx:ComboBox>
	<mx:Label x="4" y="51" text="Sucursal"/>
	<mx:ComboBox id="cboSucursal" x="4" y="68" labelField="nombre" width="170"></mx:ComboBox>
</mx:Canvas>