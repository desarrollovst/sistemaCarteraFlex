<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="684" height="200" creationPolicy="all">
	<mx:Metadata>
		[Event(name="enviarDatosSolic", type="Data.EventSolic")]
	</mx:Metadata>

	<mx:Script>
		<![CDATA[
			import Data.Utils;
			import Data.Globales;
			import mx.controls.Alert;
			import mx.validators.Validator;
			import Data.DatosSolic;
			import Data.EventSolic;
			import mx.collections.ArrayCollection;
			import mx.core.Application;
			import mx.managers.PopUpManager;
			import mx.effects.easing.Elastic;
			import mx.rpc.soap.WebService;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			
			[Bindable]
			private var _xmlCodigo:XML =  new XML();
			[Bindable]
			private var _xmlDir:XML =  new XML();
			[Bindable]
			private var _xmlCoord:XML =  new XML();
			
			public var coordObj:ArrayCollection = new ArrayCollection();
			
			public var coord:Array = new Array();
			
			public var datos:DatosSolic = new DatosSolic();
			
			public var wsMS:WebService;   					 //variable utilizada para las llamadas asincronas de WS	
			public var ws:WebService = new WebService();     //variable utilizada en las llamadas sincronas de WS
			public var du:Utils;
			public var tipoAccion:int;
			private var global:Globales;
			
			public function bloquear():void{
				loading = pLoading(PopUpManager.createPopUp(this, pLoading, true));
				PopUpManager.centerPopUp(loading);							
			}
			
			public function cambiaCoord():void{
			}
			
			public function cargaCodigo():void{
				/*if (txtCodigo.text == ""){
					initConexion();
					bloquear();
					CursorManager.setBusyCursor();
					wsMS.addEventListener(ResultEvent.RESULT, getRegGrupoESIA);
					wsMS.getRegGrupoESIA.send(cboCoordinacion.selectedItem.id);
				}*/
			}
			
			public function cargaDireccion():void{
				var j:int;
				var coord:String;
				
				initConexion();
				bloquear();
				CursorManager.setBusyCursor();
				wsMS.addEventListener(ResultEvent.RESULT, getDirCoordESIA);
				wsMS.getDirCoordESIA.send(coord);
			}
			
			public function desbloquear():void{
				PopUpManager.removePopUp(loading)	
			}
			
			public function enviarDatosSolic(formData:DatosSolic):void{
				//var invalidArray:Array = Validator.validateAll([nombreV, fechaV, coordinacionV, entFedV, municipioV, localidadV, coloniaV]);
				var j:int;
				
				//if(invalidArray.length == 0){	
					/*formData.cdgEnt = datos.cdgEnt;
					formData.cdgMun = datos.cdgMun;
					formData.cdgLoc = datos.cdgLoc;
					formData.cdgCol = datos.cdgCol;
					formData.guardaDatos = true;*/
				//}
				//else{
				//	formData.guardaDatos = false;
				//}
				var event:EventSolic = new EventSolic("enviarDatosSolic", formData);
				dispatchEvent(event);
			}
			
			public function formateaCoord():void{
				var i:int;
				var cont:int = _xmlCoord.elements().length();
				var oItem:Object
				
				oItem = new Object();
				oItem.id = "0";	
				oItem.nombre = "--Seleccionar--";
				coordObj.addItem(oItem);
				
				for (i = 0; i < cont; i++)
				{
					oItem = new Object();
					oItem.id = _xmlCoord.Table[i].CODIGO;	
					oItem.nombre = _xmlCoord.Table[i].NOMBRE;
					coordObj.addItem(oItem);
					coord[i + 1] = _xmlCoord.Table[i].NOMBRE.toString();
				}
			}
			
			private function getDirCoordESIA(event:ResultEvent):void{
				wsMS.disconnect();
				desbloquear();
				CursorManager.removeBusyCursor();
				wsMS.removeEventListener(ResultEvent.RESULT, getDirCoordESIA);
				this._xmlDir = new XML(event.result);
				if (this._xmlDir.elements().length() > 0)
					llenaDireccion();
				else
					limpiaCamposDir();
			}
			
			private function getRegGrupoESIA(event:ResultEvent):void{
				wsMS.disconnect();
				desbloquear();
				CursorManager.removeBusyCursor();
				wsMS.removeEventListener(ResultEvent.RESULT, getRegGrupoESIA);
				_xmlCodigo = new XML(event.result);
				if (_xmlCodigo.elements().length() > 0){
					var i:int;
					var codigo:String = _xmlCodigo.Table[0].CODIGO.toString();
					for(i = codigo.length; i < 3; i++)
						codigo = "0" + codigo;
				}
			}
			
			public function init(info:DatosSolic, tipoAccion:int):void{
				this.tipoAccion = tipoAccion;
				global = new Globales();
				du = new Utils();
				initConexion();
				du.sCursor();
				bloquear();
					
				du.ejecutaWsMethod(wsMS,function(evt:ResultEvent):void {											
					_xmlCoord = new XML(evt.result.toString());
					
					desbloquear();
					du.rCursor();
					du.closeWs(wsMS);
					
					if (_xmlCoord.elements().length() > 0){
						formateaCoord();
					} 	
					if (info != null){
						var j:int;
						
						/*datos.cdgEnt = info.cdgEnt;
						datos.cdgMun = info.cdgMun;
						datos.cdgLoc = info.cdgLoc;
						datos.cdgCol = info.cdgCol;*/
					}	
				});
				wsMS.getCoordUsuESIA.send(Application.application.U_ID);
			}
			
			public function initConexion():void{				
				wsMS = new WebService();			
				wsMS.wsdl = Application.application.wsStr.wsdlServ.toString();
				wsMS.loadWSDL();
			}	
			
			public function limpiaCamposDir():void{
				
			}
			
			public function llenaDireccion():void{
				/*datos.cdgEnt = _xmlDir.Table[0].CDGEF;
				datos.entidad = _xmlDir.Table[0].ENTFED;
				datos.cdgMun = _xmlDir.Table[0].CDGMU;
				datos.municipio = _xmlDir.Table[0].MUNIC;
				datos.cdgLoc = _xmlDir.Table[0].CDGLO;
				datos.localidad = _xmlDir.Table[0].LOC;
				datos.cdgCol = _xmlDir.Table[0].CDGCOL;
				datos.colonia = _xmlDir.Table[0].COL;
				datos.codPostal = _xmlDir.Table[0].CDGPOSTAL;*/
				
			}
			
	]]>
	</mx:Script>
	<mx:DataGrid x="152" y="58" width="380" height="132">
		<mx:columns>
			<mx:DataGridColumn headerText="Column 1" dataField="col1"/>
			<mx:DataGridColumn headerText="Column 2" dataField="col2"/>
			<mx:DataGridColumn headerText="Column 3" dataField="col3"/>
		</mx:columns>
	</mx:DataGrid>
	<mx:Canvas x="474" y="10" width="200" height="40" styleName="canvasMod">
	</mx:Canvas>
</mx:Canvas>
