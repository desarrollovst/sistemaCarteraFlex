<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="280" height="110" backgroundAlpha="1.0" 
	backgroundColor="#FFFFFF" creationPolicy="all" creationComplete="initApp()" 
	verticalScrollPolicy="off" horizontalScrollPolicy="off" xmlns:Data="Data.*">
	<mx:states>
		<mx:State name="vigencia">
			<mx:SetProperty name="height" value="220"/>
			<mx:AddChild position="lastChild">
				<mx:Label x="16.25" y="106" text="Par치metros" width="124.25"/>
			</mx:AddChild>
			<mx:AddChild position="lastChild">
				<mx:Canvas x="16.25" y="125.5" width="247.54999" height="50.5" styleName="canvasMod" id="cnvPrestamo0">
					<mx:Label id="lblAcred" x="48.25" y="15" text="Acreditado:" height="20"/>
					<mx:TextInput id="txtCodigo" x="117.25" y="13" maxChars="6" restrict="0-9" enter="ejecuta()"/>
				</mx:Canvas>
			</mx:AddChild>
			<mx:AddChild position="lastChild">
				<mx:Button x="65" y="184" label="Aceptar" click="ejecuta()" id="btnAceptar"/>
			</mx:AddChild>
			<mx:AddChild position="lastChild">
				<mx:Button x="144" y="184" label="Limpiar" width="71" height="24" click="limpiar()" id="btnLimpiar"/>
			</mx:AddChild>
		</mx:State>
	</mx:states>
	<mx:transitions>
		<mx:Transition fromState="" toState="*">		
			<mx:Parallel>
				<mx:Resize duration="500" target="{this}"/> 
			</mx:Parallel>
		</mx:Transition>
		<mx:Transition fromState="desautoriza" toState="*">		
			<mx:Parallel>
				<mx:Resize duration="500" target="{this}"/> 
			</mx:Parallel>
		</mx:Transition>
		<mx:Transition fromState="desembolso" toState="*">		
			<mx:Parallel>
				<mx:Resize duration="500" target="{this}"/> 
			</mx:Parallel>
		</mx:Transition>
	</mx:transitions>
	
	<mx:Script>
		<![CDATA[
			import Data.Permisos;
			import Data.Globales;
			import Data.Utils;
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.core.Application;
			import mx.effects.easing.Elastic;	
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.soap.WebService;
			import mx.utils.ObjectUtil;
			
			private var global:Globales;
			private var permiso:Permisos;
			private var du:Utils;
			public var wsMS:WebService;
			public var titulo:String;
			
			private var tipoMovObj:ArrayCollection = new ArrayCollection();
			
			//funcion que ejecuta el proceso de modificacion de prestamo
			private function ejecuta():void{
				if(valida()){
					initConexion();
					du.sCursor();
					
					var tipo:int = int(cboTipoMov.selectedItem.tipo);
					var codigo:String = txtCodigo.text;
					
					global.bloquear();
						
					du.ejecutaWsMethod(wsMS,function(evt:ResultEvent):void {											
						var res:String = evt.result.toString();
						
						du.rCursor();
						du.closeWs(wsMS);
						
						global.desbloquear();
						
						if(res.substr(0,1) == "1"){
							limpiar();
							Alert.show("Modificaci칩n realizada exitosamente.",titulo,4,null,null,global.iInfo);
						}
						else
							Alert.show(res.substr(2, res.length),titulo,4,null,null,global.iAlert);		
					});
					wsMS.setAccionModAcred.send(tipo, codigo, global.obtenerUsuario());
				}
			}
			
			private function formateaTipoMov():void{
				var oItem:Object;
				var item:Array = new Array;
				var perfil:String = global.obtenerCadPerfil();
				
				oItem = new Object();
				oItem.tipo = 0;
				oItem.state = "";	
				oItem.nombre = "--Seleccionar--";
				item.push(oItem);
				
				if(permiso.permisosModVigencia(global.obtenerArrayPerfil())){
					oItem = new Object();
					oItem.tipo = 1;
					oItem.id = "vigencia";	
					oItem.nombre = "Modificaci칩n de Vigencia";
					item.push(oItem);
				}
				tipoMovObj = new ArrayCollection(item);
			}			
						
			public function initApp():void{
				du = new Utils();
				global = new Globales();
				permiso = new Permisos();
				titulo = "Correcciones Por Acreditado";
				lblTitulo.text = titulo.toUpperCase();
				formateaTipoMov();
				cboTipoMov.dataProvider = tipoMovObj;
			}		
			
			private function initConexion():void{				
				wsMS = new WebService();			
				wsMS.wsdl = Application.application.wsStr.wsdlServ.toString();
				wsMS.loadWSDL();
			}	
		
			private function limpiar():void{
				txtCodigo.text = "";
				txtCodigo.setFocus();
				cboTipoMov.selectedIndex = 0;
				modificaEstado(); 
			}
			
			private function modificaEstado():void{
				this.currentState = cboTipoMov.selectedItem.id;
			}
				
			private function valida():Boolean{
				if(txtCodigo.text == ""){
					Alert.show("Capture el C칩digo de Acreditado.",titulo,4,null,null,global.iAlert);
					return false;
				} 
				return true;
			}
		]]>
	</mx:Script>
	<mx:Label id="lblTitulo" x="16.5" y="10" width="247" fontSize="12" fontWeight="bold" fontStyle="italic"/>
	<mx:Canvas x="16.5" y="57" width="247.5" height="41" id="cnvTipoMov" styleName="canvasMod">
		<mx:ComboBox id="cboTipoMov" x="10" y="7" width="227.5" labelField="nombre" change="modificaEstado()"/>	
	</mx:Canvas>
	<mx:Label x="16.5" y="38" text="Tipo de Movimiento" width="124.25"/>
</mx:Canvas>