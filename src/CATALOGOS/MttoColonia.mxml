<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="490" height="410" 
	creationPolicy="all" xmlns:Forms="CATALOGOS.Forms.*">
	<mx:Script>
	<![CDATA[
		import Data.EventCol;
		import Data.DatosCol;
		import Data.Utils;
		import Data.Globales;
		import mx.collections.ArrayCollection;
		import mx.controls.Alert;
		import mx.core.Application;
		import mx.effects.*;
		import mx.events.CloseEvent;
		import mx.events.EffectEvent;
		import mx.managers.PopUpManager;
		import mx.rpc.events.ResultEvent;
		import mx.rpc.soap.WebService;
		
		[Bindable]
		private var info:DatosCol;
		private var _xmlCol:XML =  new XML();
		
		public var openEffect:Effect = new WipeDown();
		public var closeEffect:Effect = new WipeDown();
		public var wsMS:WebService;	
		public var tipoAccion:int;
		public var titulo:String;
		private var du:Utils;
		private var global:Globales;
		
		public function cargaInfoCol(cdgCol:String):void{
			var wsCat:WebService = new WebService;
			var params:Array = new Array;
			tipoAccion = 2; 
			this.title = "EdiciÃ³n";
			
			du.initWsCat(wsCat);
			du.sCursor();
					
			du.ejecutaWsMethod(wsCat,function(evt:ResultEvent):void {											
				_xmlCol = new XML(evt.result.toString()); 
					
				du.rCursor();
				du.closeWs(wsCat);
					
				if (_xmlCol.elements().length() > 0){
					llenaRegistros();
				} 	
			});
			params[0] = txtCdgEntFed.text;
			params[1] = txtCdgMunic.text;
			params[2] = txtCdgLoc.text;
			params[3] = cdgCol;
			wsCat.getInfoRegistro.send(10, params);
		}
		
		public function cerrar():void{
			var playReverse:Boolean = true;   
            closeEffect.duration = 500;
            closeEffect.play([this], playReverse);
            closeEffect.addEventListener(EffectEvent.EFFECT_END,terminarEfecto);
		}
		
		public function enviar():void{
			info = new DatosCol();
				
			formDatosCol.enviarDatosCol(info);
			validaFinal();
		}
		
		public function guardaCol():void{
			initConexion();
			du.sCursor();
			Application.application.bloquear();
			wsMS.addEventListener(ResultEvent.RESULT, setAccionCol);
			wsMS.setAccionCol.send(tipoAccion, txtCdgEntFed.text, txtCdgMunic.text, txtCdgLoc.text, 
								   info.codigo, info.colonia, info.codPostal, info.pobreza); 			
		}
	
		public function init(cdgEntFed:String, entFed:String, cdgMunic:String, munic:String, cdgLoc:String, localidad:String):void{
			global = new Globales();
			du = new Utils();
			titulo = "Mantenimiento de Colonia";
			openEffect.duration = 1000;
			openEffect.play([this]);

			txtCdgEntFed.text = cdgEntFed;
			txtEntFed.text = entFed;
			txtCdgMunic.text = cdgMunic;
			txtMunic.text = munic;
			txtCdgLoc.text = cdgLoc;
			txtLocalidad.text = localidad;
		}
		
		public function initConexion():void{				
			wsMS = new WebService();			
			wsMS.wsdl = Application.application.wsStr.wsdlServ.toString();
			wsMS.loadWSDL();
		}	
		
		public function llenaRegistros():void{
				info = new DatosCol();
				//Datos de la Colonia
				info.codigo = _xmlCol.Table[0].CODIGO;
				info.colonia = _xmlCol.Table[0].NOMBRE;
				info.codPostal = _xmlCol.Table[0].CDGPOSTAL;
				info.pobreza = _xmlCol.Table[0].POBREZA;
			
				formDatosCol.init(info);
			}
		
		public function terminarEfecto(event:EffectEvent):void{
			closeEffect.removeEventListener(EffectEvent.EFFECT_END, terminarEfecto);
			PopUpManager.removePopUp(this);
		}
		
		public function validaDatosCol(event:EventCol):void{
			info = event.customProp;
		}
		
		public function validaFinal():void{
			if (info.guarda == true)
				guardaCol();
			else
				Alert.show("Debe capturar los datos requeridos",titulo,4,null,null,global.iAlert);
		}
		
		public function registraInfoCol():void{
			tipoAccion = 1;
			this.title = "Nuevo";
			info = null;
			formDatosCol.init(info);
		}
		
		private function setAccionCol(event:ResultEvent):void{
			wsMS.disconnect();
			du.rCursor();
			Application.application.desbloquear();
			wsMS.removeEventListener(ResultEvent.RESULT, setAccionCol);
			var res:String = event.result.toString();
			if (res.substr(0,1) == "1"){
				cerrar();
			}	
			else
				Alert.show(res.substr(2,res.length -1),titulo,4,null,null,global.iAlert);		
		}
	]]>
	</mx:Script>
	<mx:Canvas x="13" y="10" width="464" height="102" styleName="canvasMod" id="canvas1">
		<mx:Label id="lblEntFed" x="25.5" y="12" text="Entidad Federativa:"/>
		<mx:TextInput id="txtCdgEntFed" editable="false" x="130.5" y="10" width="58"/>
		<mx:TextInput id="txtEntFed" editable="false" x="196.5" y="10" width="240"/>
		<mx:Label id="lblMunic" x="70.5" y="40" text="Municipio:"/>
		<mx:TextInput id="txtCdgMunic" editable="false" x="130.5" y="38" width="58"/>
		<mx:TextInput id="txtMunic" editable="false" x="196.5" y="38" width="240" height="24"/>
		<mx:TextInput id="txtCdgLoc" editable="false" x="130.5" y="66" width="58"/>
		<mx:TextInput id="txtLocalidad" editable="false" x="196.5" y="66" width="240" height="24"/>
		<mx:Label id="lblLocalidad" x="68.5" y="68" text="Localidad:"/>
	</mx:Canvas>
	<mx:Canvas x="13" y="120" width="464" height="210" styleName="canvasMod">
		<Forms:FormDatosCol id="formDatosCol" x="10" y="10" width="442" height="188"/>
	</mx:Canvas>
	<mx:Button id="btnAceptar" x="389" y="338" icon="@Embed(source='assets/images/iconAccept.png')" click="enviar()" width="40"/>
	<mx:Button id="btnCancelar" x="437" y="338" icon="@Embed(source='assets/images/iconCancel.png')" click="cerrar()" width="40"/>
</mx:TitleWindow>