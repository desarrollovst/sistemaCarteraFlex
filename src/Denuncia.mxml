<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationPolicy="all" creationComplete="initApp()">
	
	<mx:HTTPService id="httpService"
            resultFormat="e4x"
            fault="httpService_fault(event);"
            result="httpService_result(event)" />
	
	<!--<mx:Style source="css/orangeMin.css"/>-->      
	 
    <mx:Script>
	<![CDATA[
		import Data.Globales;
		import Data.Utils;
		import mx.controls.Alert;	
		import mx.rpc.events.FaultEvent;
		import mx.rpc.events.ResultEvent;
		import mx.rpc.soap.WebService;
		
		private var du:Utils;
		private var global:Globales
		public var wsMS:WebService;
		public var titulo:String;
		public var wsStr:XML = new XML();
        
        public function enviar():void{
			if(txtDesc.text != ""){
				var desc:String = txtDesc.text;
				
				initConexion();
				du.sCursor();
				
				du.ejecutaWsMethod(wsMS,function(evt:ResultEvent):void {											
					var res:String = evt.result.toString();
					
					du.rCursor();
					du.closeWs(wsMS);
							
					if(res.substr(0,1) == "1"){
						Alert.show("Denuncia registrada exitosamente.",titulo,4,null,null,global.iInfo);
						limpiar();
					}
					else
						Alert.show(res.substr(2,res.length -1),titulo,4,null,null,global.iAlert);		
				});
				wsMS.setRegistroDenuncia.send(desc);	
			}
			else
				Alert.show("Debe capturar la descripción de la denuncia.",titulo,4,null,null,global.iAlert);
		}
        
        private function httpService_fault(evt:FaultEvent):void {
            var title:String = evt.type + " (" + evt.fault.faultCode + ")";
            var text:String = evt.fault.faultString;                             
        }

        private function httpService_result(evt:ResultEvent):void {                                
            wsStr = new XML(evt.result.toString());                          
        }
        
        public function initApp():void{
        	global = new Globales();
        	du = new Utils(); 
        	titulo = "Denuncia Anónima";
        	httpService.url = "Config.xml";
            httpService.send();
        }
        
        public function initConexion():void{				
			wsMS = new WebService();			
			wsMS.wsdl = wsStr.wsdlServ.toString();
			wsMS.loadWSDL();
		}
        
        public function limpiar():void{
			txtDesc.text = "";
		}
	]]>
	</mx:Script>
	<mx:Canvas width="100%" height="100%" id="cnvMain">
		<mx:Panel width="746" height="400" layout="absolute" id="pnlLogin" title="Denuncia Anónima" alpha="0.7" horizontalCenter="0" verticalCenter="-2" 
			horizontalScrollPolicy="off" verticalScrollPolicy="off">
			<mx:TextArea id="txtDesc" x="26" y="31" width="694" height="281"/>
			<mx:Button x="341" y="320" label="Enviar" click="enviar()"/>
			<mx:Label x="26" y="8" text="Escriba los detalles de la denuncia:"/>
		</mx:Panel>
		<mx:Image x="10" y="10" source="images/mini.png" scaleContent="true" width="181" height="128"/>
	</mx:Canvas>
</mx:Application>